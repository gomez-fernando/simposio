(function(){function h(a,b){var e=b.components.getShortcode(a),c=jQuery.extend({},e.attrs.named,{content:e.content||"",_page:e.tag});b.doLog("page data",c);b.doAjax("get_settings_page",c,function(c){var d=jQuery(c.data);jQuery.featherlight(d,{namespace:"mmtl-lightbox",persist:!0,beforeOpen:function(c){$submit=d.find("form p.submit").remove();d.find(".mmtl-screen-content").mmtl_prepare_tabs({separator:"h3"}).tabs();d.find("form").append($submit);d.find("form").on("submit",function(c){b.trigger("settings_submit",
[d,e,a]);c=jQuery(this).serialize();b.doLog("form data",c);b.doAjax(null,c,function(c){input=b.apply_filters("sanitize_options",c.data,e,a);"object"===typeof input&&(b.doLog("input",input),c={tag:e.tag},input.hasOwnProperty("content")&&(c.content=input.content,delete input.content),c.attrs=input,c=new wp.shortcode(c),b.doLog("updatedSortcode",c),b.components.setShortcode(a,c),b.trigger("settings_update",[d,e,a,input]),b.updateSource(),b.update())});jQuery.featherlight.close();return!1})}});b.trigger("settings_page",
[d,e,a])})}function g(a,b){"undefined"===typeof b&&(b=!0);var e=a._elem.find(".mmtl-header");if(b)e.stick_in_parent({offset_top:jQuery("#wpadminbar").outerHeight(),sticky_class:"mmtl-stuck"}).on("sticky_kit:stick",function(b){a._elem.addClass("mmtl-header-stuck")}).on("sticky_kit:unstick",function(b){a._elem.removeClass("mmtl-header-stuck")});else e.trigger("sticky_kit:detach"),a._elem.removeClass("mmtl-header-stuck")}function d(a){var b=a.data.ed;jQuery(".mmtl-lightbox").is(":visible")||27==a.keyCode&&
c(b)}function c(a){var b=a._elem.find(".mmtl-control-fullscreen"),e=jQuery("#mmtl-overlay");jQuery("body").hasClass("mmtl-full-screen")?(e.data("mmtl_editor").wrap.append(a._elem),jQuery.removeData(e,"mmtl_editor"),e.empty(),b.removeClass("dashicons-editor-contract").addClass("dashicons-editor-expand"),jQuery("body").removeClass("mmtl-full-screen"),jQuery(document).off("keyup",d),a.trigger("fullscreen_toggle",[!1])):(e.data("mmtl_editor",{wrap:a._elem.parent()}),e.empty().append(a._elem),jQuery("body").addClass("mmtl-full-screen"),
b.removeClass("dashicons-editor-expand").addClass("dashicons-editor-contract"),jQuery(document).on("keyup",{ed:a},d),a.trigger("fullscreen_toggle",[!0]))}function a(a){var b=a.find("> .mmtl-component-inner > .mmtl-component-header .mmtl-control-toggle");a.hasClass("mmtl-closed")?(a.removeClass("mmtl-closed"),b.removeClass("dashicons-arrow-down").addClass("dashicons-arrow-up")):(a.addClass("mmtl-closed"),b.removeClass("dashicons-arrow-up").addClass("dashicons-arrow-down"))}function k(a){var b={},e,
c;a._elem.find('.mmtl-component[data-type="mmtl-row"], .mmtl-component[data-type="mmtl-col"]').each(function(){e=jQuery(this);c=a.components.getShortcode(e);bg_image=c.get("bg_image");if(!bg_image||0!==bg_image.indexOf("http://"))return!0;b[e.data("id")]=bg_image});jQuery.isEmptyObject(b)||a.doAjax("get_attachment_sizes",{attachment:b},function(b){b.success&&jQuery.each(b.data,function(b,c){if(!c.hasOwnProperty("thumbnail"))return!1;e=a.components.get(b);if(!e)return!0;e.find('.mmtl-meta[data-type="bg_image"]').css("background-image",
"url("+c.thumbnail.file+")")})})}function f(a){a._elem.find(".mmtl-editor .ui-sortable").sortable("destroy");var b={connectWith:"",placeholder:"mmtl-placeholder",start:function(b,e){jQuery(e.placeholder).append('<div class="mmtl-placeholder-inner"><div class="mmtl-placeholder-content"></div></div>');a._elem.addClass("mmtl-is-sorting");e.item.addClass("mmtl-is-sorting")},update:function(b,e){a.updateSource()},sort:function(b,a){var e=jQuery(a.item);jQuery(a.placeholder).removeClass().addClass("mmtl-placeholder").addClass(e.attr("class")).removeClass("ui-sortable-handle").attr("data-type",
e.attr("data-type")).find(".mmtl-placeholder-inner").height(e.innerHeight())},stop:function(b,e){jQuery(e.placeholder).empty();jQuery(e.item);a._elem.removeClass("mmtl-is-sorting");e.item.removeClass("mmtl-is-sorting")}};jQuery(".mmtl-content").sortable(b).disableSelection();var e=a._elem.find('.mmtl-component[data-type="mmtl-row"] > .mmtl-component-inner > .mmtl-component-content');e.sortable(jQuery.extend(b,{connectWith:e})).disableSelection();e=a._elem.find('.mmtl-component[data-type="mmtl-col"] > .mmtl-component-inner > .mmtl-component-content');
e.sortable(jQuery.extend(b,{connectWith:e})).disableSelection()}jQuery.fn.mmtl_equalHeight=function(){var a=0;jQuery(this).css("height","auto");this.each(function(){var b=jQuery(this).outerHeight(!1);b>a&&(a=b)});jQuery(this).css("height",a);return this};MMTL_Editor.eventManager.add("setup",function(a,b){b.add_filter("source_content",function(b){b=b.replace(/^\s*<p>\s*<\/p>/gi,"");b=b.replace(/<p>\s*(\[)/ig,"$1");return b=b.replace(/(\])\s*<\/p>/ig,"$1")},1);b.add_filter("shortcode_replacement",function(a,
c){return b.components.create(c,a)},15);b.add_filter("sanitize_options",function(b){if("object"===typeof b){var a={};jQuery.each(b,function(b,e){a[b]=e.replace(/\\/g,"")});b=a}return b},1);b._elem.on("click","a.mmtl-control",function(a){a=b.controls.get(jQuery(this).data("type"));var c=jQuery(this).closest(".mmtl-component");a.click(c);jQuery(this).blur();return!1});b.on("init",function(a){b._elem.on("click",".mmtl-add-component-button",function(a){a=jQuery(this);a.blur();a=a.data("type");b.shortcodes.hasTag(a)&&
(a=new wp.shortcode({tag:a}),a=b.components.create(a),b.components.add(a,null),b.updateSource(),b.update());return!1})});b.add_control("add",{text:b.option("control_label_add"),title:b.option("control_label_add"),icon:"plus",click:function(a){var c=b.components.getShortcode(a),d=b.components.getData(c.tag);0!=d.accepts.length&&(1==d.accepts.length?(c=b.components.create(new wp.shortcode({tag:d.accepts[0]})),b.components.getShortcode(c),b.components.add(c,a,!1),b.updateSource(),b.update()):b.doAjax("get_components_screen",
{id:c.tag},function(c){$elem=jQuery(c.data);$elem.find(".mmtl-component").mmtl_equalHeight();jQuery.featherlight($elem,{namespace:"mmtl-lightbox",persist:!0});$elem.find(".mmtl-component").on("click",function(c){c=jQuery(this).data("type");c=b.components.create(new wp.shortcode({tag:c}));b.components.add(c,a,!1,"picklist");jQuery.featherlight.close();return!1})}))}});b.add_control("copy",{text:b.option("control_label_copy"),title:b.option("control_label_copy"),icon:"admin-page",click:function(a){var c=
b.components.copy(a);b.components.add(c,jQuery(a).parent(),jQuery(a).index()+1);b.updateSource();b.update()}});b.add_control("delete",{text:b.option("control_label_delete"),title:b.option("control_label_delete"),icon:"trash",click:function(a){window.confirm(b.options.get("confirm_delete"))&&(b.components.remove(a),b.updateSource())}});b.add_control("add_before",{text:b.option("control_label_add"),title:b.option("control_label_add"),icon:"plus",click:function(a){a=jQuery(a);var c=b.components.getShortcode(a),
c=new wp.shortcode({tag:c.tag}),c=b.components.create(c);b.components.add(c,a.parent(),a.index());b.updateSource();b.update()}});b.add_control("add_after",{text:b.option("control_label_add"),title:b.option("control_label_add"),icon:"plus",click:function(a){a=jQuery(a);var c=b.components.getShortcode(a),c=new wp.shortcode({tag:c.tag}),c=b.components.create(c);b.components.add(c,a.parent(),a.index()+1);b.updateSource();b.update()}});b.add_filter("default_options",function(a){return jQuery.extend(a,
{confirm_delete:"Are you sure you want to delete this component?",control_label_add:"Add",control_label_edit:"Edit",control_label_copy:"Copy",control_label_delete:"Delete"})})});MMTL_Editor.eventManager.add("setup",function(a,b){b.add_control("edit",{text:b.option("control_label_edit"),title:b.option("control_label_edit"),icon:"edit",click:function(a){h(a,b)}});b.on("component_added",function(a,c,d){"picklist"==d&&h(c,b)})});MMTL_Editor.eventManager.add("setup",function(a,b){b.on("init",function(a){g(b)});
b.on("fullscreen_toggle",function(a,c){c?g(b,!1):g(b)})});MMTL_Editor.eventManager.add("setup",function(a,b){b.add_control("fullscreen",{text:b.option("control_label_fullscreen"),title:b.option("control_label_fullscreen"),icon:"editor-expand",click:function(){c(b)}});b.add_filter("header_controls",function(a){a.push("fullscreen");return a},15);b.on("init",function(){jQuery("body").append('<div id="mmtl-overlay"></div>')});b.on("destroy",function(){jQuery("body").find("> #mmtl-overlay").remove()});
b.add_filter("default_options",function(a){return jQuery.extend(a,{control_label_fullscreen:"Toggle full screen"})})});MMTL_Editor.eventManager.add("setup",function(c,b){b.add_control("toggle",{text:b.option("control_label_toggle"),title:b.option("control_label_toggle"),icon:"arrow-up",click:function(b){a(b)}});b.on("init",function(c){b._elem.on("click",".mmtl-component > .mmtl-component-inner > .mmtl-component-header:has( .mmtl-control-toggle )",function(b){b.stopPropagation();b=jQuery(this).closest(".mmtl-component");
a(b);return!1})});b.add_filter("default_options",function(a){return jQuery.extend(a,{control_label_toggle:"Toggle"})})});MMTL_Editor.eventManager.add("setup",function(a,b){b.add_filter("component_meta",function(a,c){if(-1!=["mmtl-row","mmtl-col"].indexOf(c.tag)){c.get("bg_image")&&a.push({title:b.option("meta_title_bg_image"),type:"bg_image",text:""});var d=c.get("id");d&&a.push({title:b.option("meta_title_id"),type:"id",text:d});(d=c.get("class"))&&jQuery.each(d.split(" "),function(c,d){a.push({title:b.option("meta_title_class"),
type:"class",text:d})})}return a});b.on("update",function(){k(b)})});MMTL_Editor.eventManager.add("setup",function(a,b){b.on("init",function(a){f(b)});b.on("update",function(a){f(b)});b.on("component_added",function(a){f(b)})});MMTL_Editor.eventManager.add("setup",function(a,b){b.on("settings_page",function(a,c,d,f){c.find(".mmtl-media").each(function(){var a=jQuery(this),c=a.find(".mmtl-media-add"),d=a.find(".mmtl-media-remove"),e=a.find(".mmtl-media-field"),f=a.find(".mmtl-media-image");c.on("click",
function(c){wp.media.editor.send.attachment=function(c,d){e.val(d.sizes[c.size].url);var k=d.sizes.thumbnail;b.doLog("image sizes",d.sizes);a.addClass("mmtl-has-image");f.removeClass("mmtl-image-h mmtl-image-v").addClass(k.width>k.height?"mmtl-image-h":"mmtl-image-v").attr("src",k.url).show()};wp.media.editor.open("mmtl_editor_bg_image");return!1});d.on("click",function(b){f.removeAttr("src").hide();a.removeClass("mmtl-has-image");e.val("");return!1});e.val()&&(c=e.val(),b.doAjax("get_attachment_sizes",
{attachment:c},function(b){b.success&&(b=b.data.thumbnail,a.addClass("mmtl-has-image"),f.removeClass("mmtl-image-h mmtl-image-v").addClass(b.width>b.height?"mmtl-image-h":"mmtl-image-v").attr("src",b.file).show())}))})})})})();
(function(){function h(g,d){var c=d.components.getShortcode(g),a=c.string(),k={source:a},k=jQuery(wp.template("mmtl-component-source-edit")(k)),f=k.find("form"),l=f.find('textarea[name="source"]'),b=f.find(".notice");b.hide();f.on("submit",function(e){e.preventDefault();e=l.val();if(e!=a){e=wp.shortcode.next(c.tag,e,0);if(!e||!e.hasOwnProperty("shortcode")||!e.shortcode instanceof wp.shortcode||"undefined"===typeof c.content)return b.show(),!1;e=d.do_shortcode(e.shortcode.string());jQuery(g).replaceWith(e);
d.updateSource();d.update()}jQuery.featherlight.close()});jQuery.featherlight(k,{namespace:"mmtl-lightbox",persist:!0,afterOpen:function(){l.focus(function(){this.select()}).focus()}})}MMTL_Editor.eventManager.add("setup",function(g,d){d.add_control("source",{text:d.option("control_label_source"),title:d.option("control_label_source"),icon:"editor-code",click:function(c){h(c,d)}});d.on("shortcode_update",function(c,a,d,f){})})})();
(function(){function h(d,c){var a=jQuery(d).find('> .mmtl-component-inner > .mmtl-component-content > .mmtl-component[data-type="mmtl-col"]'),k=[],f;jQuery.each(a,function(a,b){f=c.components.getShortcode(b);var d=f.get("width");if(!d)return!0;k.push(d)});return k.join(" + ")}function g(d,c,a){c=c?c.replace(/\s+/g,"").split("+"):[];var k=jQuery(d).find('> .mmtl-component-inner > .mmtl-component-content > .mmtl-component[data-type="mmtl-col"]'),f,g;jQuery.each(c,function(b,c){b<k.length?(f=k.eq(b),
g=a.components.getShortcode(f),g.set("width",c),a.components.setShortcode(f,g)):(g=new wp.shortcode({tag:"mmtl-col",attrs:{width:c},type:"closed"}),f=a.components.create(g),a.components.add(f,d))});jQuery.each(k.filter(":gt("+(c.length-1)+")"),function(){a.components.remove(this)})}MMTL_Editor.eventManager.add("setup",function(d,c){c.add_shortcode("mmtl-row",function(a,d){return c.do_shortcode(d)});c.on("settings_page",function(a,d,f,g){"mmtl-row"==f.tag&&(d.find('input[name="layout"]').val(h(g,c)),
d.find(".mmtl-layout a").click(function(a){a=jQuery(this);var c=a.attr("title");d.find(':input[name="layout"]').val(c);d.find("a").removeClass("mmtl-active");a.addClass("mmtl-active");return!1}),a=d.find('input[name="layout"]').val(),d.find('.mmtl-layout a[title="'+a+'"]').addClass("mmtl-active"))});c.on("settings_update",function(a,d,f,h){"mmtl-row"==f.tag&&g(h,d.find(':input[name="layout"]').val(),c)});c.add_filter("component",function(a,c){if("mmtl-row"==c.tag){var d=jQuery(a);d.find("> .mmtl-component-inner > .mmtl-component-content").addClass("mmtl-row");
a=MMTL_Editor.helpers.toHTML(d)}return a});c.add_filter("default_options",function(a){return jQuery.extend(a,{meta_title_id:"ID",meta_title_class:"Class",meta_title_bg_image:"Background image"})});c.add_filter("source_content",function(a){(a=jQuery.trim(a))&&0!==a.indexOf("[mmtl-row")&&(a='[mmtl-row][mmtl-col width="1/1"][mmtl-text]'+a+"[/mmtl-text][/mmtl-col][/mmtl-row]",c.on("init",function(a){c.updateSource()}));return a},5)})})();
(function(){function h(d){switch(d){case 1:return"1/12";case 2:return"1/6";case 3:return"1/4";case 4:return"1/3";case 5:return"5/12";case 6:return"1/2";case 7:return"7/12";case 8:return"2/3";case 9:return"3/4";case 10:return"5/6";case 11:return"11/12";default:return"1/1"}}function g(d){switch(d){case "1/12":return 1;case "1/6":return 2;case "1/4":return 3;case "1/3":return 4;case "5/12":return 5;case "1/2":return 6;case "7/12":return 7;case "2/3":return 8;case "3/4":return 9;case "5/6":return 10;
case "11/12":return 11;default:return 12}}MMTL_Editor.eventManager.add("setup",function(d,c){c.add_shortcode("mmtl-col",function(a,d){return c.do_shortcode(d)});c.add_control("col_decrease_width",{text:c.option("control_label_col_decrease_width"),title:c.option("control_label_col_decrease_width"),icon:"arrow-left",click:function(a){a=jQuery(a);var d=c.components.getShortcode(a),f=g(d.get("width"));1>=f||(a.removeClass("mmtl-col-sm-"+f),f--,a.addClass("mmtl-col-sm-"+f),f=h(f),d.set("width",f),a.find(".mmtl-control-col_width").text(f),
c.updateSource())}});c.add_control("col_increase_width",{text:c.option("control_label_col_increase_width"),title:c.option("control_label_col_increase_width"),icon:"arrow-right",click:function(a){a=jQuery(a);var d=c.components.getShortcode(a),f=g(d.get("width"));12<=f||(a.removeClass("mmtl-col-sm-"+f),f++,a.addClass("mmtl-col-sm-"+f),f=h(f),d.set("width",f),a.find(".mmtl-control-col_width").text(f),c.updateSource())}});c.add_control("col_width",{text:c.option("control_label_col_width"),title:c.option("control_label_col_width"),
icon:"",click:function(){}});c.add_filter("component",function(a,c){if("mmtl-col"==c.tag){var d=jQuery(a);d.addClass("mmtl-col");(value=c.get("offset"))&&d.addClass("mmtl-col-sm-offset-"+g(value));c.get("width")||c.set("width","1/1");var h=c.get("width");d.addClass("mmtl-col-sm-"+g(h));d.find(".mmtl-control-col_width").text(h);a=d.get(0)}return a});c.add_filter("component_meta",function(a,d){"mmtl-col"==d.tag&&((value=d.get("push"))&&a.push({title:c.option("meta_title_push"),type:"push",text:value+
' <span class="dashicons dashicons-arrow-right"></span> '}),(value=d.get("pull"))&&a.push({title:c.option("meta_title_pull"),type:"pull",text:'<span class="dashicons dashicons-arrow-left"></span> '+value}));return a});c.add_filter("default_options",function(a){return jQuery.extend(a,{meta_title_push:"Push",meta_title_pull:"Pull",control_label_col_width:"Width",control_label_col_increase_width:"Increase width",control_label_col_decrease_width:"Decrease width"})})})})();
(function(){MMTL_Editor.eventManager.add("setup",function(h,g){g.add_shortcode("mmtl-heading",function(d,c){var a=jQuery.extend({content:c},d);return wp.template("mmtl-shortcode-heading")(a)})})})();
(function(){MMTL_Editor.eventManager.add("setup",function(h,g){g.add_shortcode("mmtl-icon",function(d,c){var a=jQuery.extend({},d);return wp.template("mmtl-shortcode-icon")(a)});g.on("settings_page",function(d,c,a,h){if("mmtl-icon"==a.tag){d=c.find(".mmtl-icon-picker");var f=d.find(".mmtl-icon-picker-output"),l=d.find(".mmtl-icon-picker-icons");a=d.find("select.mmtl-icon-picker-lib");var b=c.find(':input[name="icon"]'),e=d.find(".mmtl-icon-picker-search");f.hide();e.prop("disabled",!0);a.on("change",
function(a){a=jQuery(this).val();e.val("");if(!a)return l.empty(),e.prop("disabled",!0),!1;f.find("p").empty();g.doAjax("get_icon_picker",{lib_id:a},function(a){a.success?(l.html(a.data),l.find("li").on("click",function(){$icon=jQuery(this);l.find("li.mmtl-active").removeClass("mmtl-active");$icon.addClass("mmtl-active");b.val($icon.data("id"))}),(a=b.val())&&l.find('li[data-id="'+a+'"]').addClass("mmtl-active"),e.prop("disabled",!1)):(f.find("p").text(a.data),f.show())})}).trigger("change");e.keyup(function(a){var b=
jQuery(this).val();l.find("li").show().filter(function(){return-1==jQuery(this).data("id").indexOf(b)}).hide()})}})})})();(function(){MMTL_Editor.eventManager.add("setup",function(h,g){g.add_shortcode("mmtl-button",function(d,c){var a=jQuery.extend({content:c},d);return wp.template("mmtl-shortcode-button")(a)})})})();(function(){MMTL_Editor.eventManager.add("setup",function(h,g){g.add_shortcode("mmtl-space",function(d,c){var a=jQuery.extend({content:c},d);return wp.template("mmtl-shortcode-space")(a)})})})();
(function(){MMTL_Editor.eventManager.add("setup",function(h,g){g.add_shortcode("mmtl-text",function(d,c){var a=jQuery.extend({content:c},d);return wp.template("mmtl-shortcode-html")(a)});g.on("settings_page",function(d,c,a,g){"mmtl-text"==a.tag&&(c.find(':input[name="content"]').val(a.content||""),MMTL_Editor.helpers.initWPEditor("mmtl_content"))});g.on("settings_submit",function(d,c,a,g){"mmtl-text"==a.tag&&switchEditors.go("mmtl_content","html")})})})();
MMTL_Editor.eventManager.add("setup",function(h,g){g.on("update",function(d,c,a){g.doLog(d.type)});g.on("source_update",function(d,c,a){g.doLog(d.type)})});
(function(){function h(d){if(0===jQuery("textarea#"+d).length)return!1;var c=jQuery("#wp-"+d+"-wrap");if(0==c.length)return!1;if(c.hasClass("tmce-active")&&"undefined"!==typeof tinymce){var a=tinymce.get(d);if(a&&a.initialized)switchEditors.go(d,"html");else tinymce.on("SetupEditor",function(a){if("content"==a.id)a.on("init",function(){switchEditors.go(d,"html")})})}c=c.closest("#postdivrich");a=jQuery('<div class="postbox"></div>');a.insertAfter(c.hide());MMTL_Editor.create(a,d,MMTL_Options);jQuery("body").removeClass("mmtl-inactive").addClass("mmtl-active");
return!0}function g(d,c){var a={};d=jQuery.extend(d,(a[MMTL_Options.noncename]=MMTL_Options.nonce,a));return jQuery.post(MMTL_Options.ajaxurl,d,c)}jQuery(document).ready(function(){jQuery(".mmtl-activate").on("click",function(d){h(MMTL_Options.post_editor_id)&&g({action:"mmtl_set_editor_state",post_id:MMTL_Options.post_id,active:1});return!1});jQuery(".mmtl-deactivate").on("click",function(d){d=MMTL_Options.post_editor_id;var c=jQuery("#mmtl-"+d+"-wrap");if(0==c.length)d=!1;else{var a=jQuery("#wp-"+
d+"-wrap");0==a.length?d=!1:(a=a.closest("#postdivrich"),switchEditors.go(d,"html"),switchEditors.go(d,"tmce"),MMTL_Editor.remove(d),c.remove(),a.show(),jQuery("body").removeClass("mmtl-active").addClass("mmtl-inactive"),d=!0)}d&&g({action:"mmtl_set_editor_state",post_id:MMTL_Options.post_id,active:0});return!1});jQuery("body").hasClass("mmtl-active")&&h(MMTL_Options.post_editor_id)})})();