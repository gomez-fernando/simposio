(function(){function h(a){this._ed=a;this._options={}}function k(a){this._ed=a}function l(a){this._ed=a;this._filters={}}function m(a){this._ed=a;this._shortcode_tags={}}function n(a){this._ed=a}function p(a){this._ed=a}function q(a){this._ed=a;this._ed.add_filter("default_options",function(a){return jQuery.extend(a,{noncename:"_wpnonce",nonce:"",ajaxurl:""})})}var g={_editors:{},create:function(a,b,c){a=new g(b,a,b,c);this._editors[b]=a;this.eventManager.dispatch("editor_added",a)},get:function(a){return this._editors.hasOwnProperty(a)?
this._editors[a]:null},remove:function(a){var b=this.get(a);b&&(delete this._editors[a],b.destroy(),this.eventManager.dispatch("editor_removed",b),delete b)},eventManager:{dispatch:function(a,b){jQuery(document).trigger(this._prefix(a),b)},add:function(a,b){jQuery(document).on(this._prefix(a),b)},remove:function(a,b){var c=this;if("undefined"===typeof a){var d=jQuery(document).data("events");jQuery.each(d,function(a,b){if(0!==a.indexOf(this._prefix()))return!0;c.remove(a)})}else"undefined"===typeof b?
jQuery(document).off(this._prefix(a)):jQuery(document).off(this._prefix(a),b)},_prefix:function(a){a=a||"";0!==a.indexOf("mmtl-editor:")&&(a="mmtl-editor:"+a);return a}},helpers:{toHTML:function(a){return jQuery("<div></div>").append(a).html()},getFormData:function(a){a=jQuery(a);a.is("form")||(a=a.find(":input"));var b={};jQuery.each(a.serializeArray(),function(a,d){b.hasOwnProperty(d.name)?(b[d.name]=jQuery.makeArray(b[d.name]),b[d.name].push(d.value)):b[d.name]=d.value});return b},initWPEditor:function(a){if("undefined"!==
typeof tinymce&&"undefined"!==typeof tinyMCEPreInit){tinymce.execCommand("mceRemoveEditor",!0,a);var b=tinyMCEPreInit.mceInit[a];!jQuery("#wp-"+a+"-wrap").hasClass("tmce-active")&&tinyMCEPreInit.qtInit.hasOwnProperty(a)||b.wp_skip_init||(tinymce.init(b),window.wpActiveEditor||(window.wpActiveEditor=a));"undefined"!==typeof quicktags&&(quicktags(tinyMCEPreInit.qtInit[a]),window.wpActiveEditor||(window.wpActiveEditor=a));window.switchEditors&&window.switchEditors.go(a,"tmce")}}}},g=jQuery.extend(function(a,
b,c,d){this._id=a;this._elem=jQuery(b);this._textarea=jQuery("#"+c);this._elem.addClass("mmtl-editor").attr("id","mmtl-"+this.id()+"-wrap");this.options=new h(this);this.events=new k(this);this.filters=new l(this);this.shortcodes=new m(this);this.components=new n(this);this.controls=new p(this);this.ajax=new q(this);this.options._options=jQuery.extend(this.options.getDefaults(),d);g.eventManager.dispatch("setup",this);a=this.apply_filters("header_controls",[]);a={controls:this.controls.getHTML(a)};
this._elem.html(wp.template("mmtl-main")(a));this.update();this.trigger("init")},g);jQuery.extend(g.prototype,{constructor:g,_elem:null,_textarea:null,options:null,events:null,filters:null,shortcodes:null,components:null,controls:null,ajax:null,id:function(){return this._id},option:function(a,b){if("undefined"===typeof b)return this.options.get(a);this.options.set(a,b)},getContent:function(){return this.apply_filters("content",this.components.toShortcode())},setContent:function(a){a=this.do_shortcode(a);
this._elem.find(".mmtl-content").html(a)},add_shortcode:function(){this.shortcodes.add.apply(this.shortcodes,arguments)},do_shortcode:function(){return this.shortcodes["do"].apply(this.shortcodes,arguments)},add_filter:function(){this.filters.add.apply(this.filters,arguments)},apply_filters:function(){return this.filters.apply.apply(this.filters,arguments)},add_control:function(){return this.controls.add.apply(this.controls,arguments)},add_screen:function(){this.screens.add.apply(this.screens,arguments)},
get_screen:function(){return this.screens.get.apply(this.screens,arguments)},trigger:function(){this.events.dispatchEvent.apply(this.events,arguments)},on:function(){this.events.addListener.apply(this.events,arguments)},doAjax:function(){return this.ajax.sendRequest.apply(this.ajax,arguments)},update:function(){var a=this.apply_filters("source_content",this._textarea.val());this.setContent(a);this.trigger("update",[a])},updateSource:function(){var a=this._textarea.val(),b=this.getContent();this._textarea.val(b);
this.trigger("source_update",[b,a])},doLog:function(){if(this.option("debug")){var a=Array.prototype.slice.call(arguments);a.unshift("[mmtl_editor#"+this.id()+"]");console.log.apply(console,a)}},destroy:function(){this.events.dispatchEvent("destroy");this.events.removeListeners();this._elem.removeClass("mmtl-editor").removeAttr("id").empty().off()}});h.prototype={constructor:h,_ed:null,_options:{},get:function(a){return this._options.hasOwnProperty(a)?this._options[a]:null},set:function(a,b){var c=
this;if("object"===typeof a)jQuery.each(a,function(a,b){c.set(a,b)});else if(this._options.hasOwnProperty(a)){var d=this._options[a];d!==b&&(this._options[a]=b,this._ed.trigger("option_update",[this._ed,b,d]))}},getDefaults:function(){return this._ed.apply_filters("default_options",{})}};k.prototype={constructor:k,_ed:null,dispatchEvent:function(a){this._ed._elem.trigger.apply(this._ed._elem,arguments)},addListener:function(a,b){this._ed._elem.on.apply(this._ed._elem,arguments)},removeListeners:function(){this._ed._elem.off()}};
l.prototype={constructor:l,_ed:null,_filters:{},add:function(a,b,c){"undefined"===typeof c&&(c=10);this._filters.hasOwnProperty(a)||(this._filters[a]={});var d=this._filters[a];if(!d.hasOwnProperty(c)){d[c]=[];a=Object.keys(d).sort();var e={};jQuery.each(a,function(a,b){e[b]=d[b]});d=e}d[c].push(b)},apply:function(a,b){if(this._filters.hasOwnProperty(a)){var c=Array.prototype.slice.call(arguments).slice(1);jQuery.each(this._filters[a],function(a,b){jQuery.each(b,function(a,b){c[0]=b.apply(this,c)})});
b=c[0]}return b}};m.prototype={constructor:m,_ed:null,_shortcode_tags:{},get:function(a){return this._shortcode_tags[a]},getTags:function(){return Object.keys(this._shortcode_tags)},hasTag:function(a){return this._shortcode_tags.hasOwnProperty(a)},add:function(a,b){this._shortcode_tags[a]=b},"do":function(a){a=this._ed.apply_filters("sanitize_content",a);var b=this,c;jQuery.each(this._shortcode_tags,function(d,e){a=wp.shortcode.replace(d,a,function(a){a=b._ed.shortcodes.copyShortcodeObject(a);c=e(a.attrs.named,
a.content||"");c=b._ed.apply_filters("shortcode_replacement",c,a);return c=g.helpers.toHTML(c)})});return a},copyShortcodeObject:function(a){return new wp.shortcode({tag:a.tag,attrs:a.attrs.named,type:a.type,content:a.content||""})}};n.prototype={constructor:n,_ed:null,_counter:0,_data:{},create:function(a,b){var c=++this._counter,d=this.getData(a.tag),e=this._ed.apply_filters("component_meta",[],a),d=wp.template("mmtl-component")({id:c,meta:this.getMetaHTML(e),tag:a.tag,type:d.type,content:b||"",
controls:this._ed.controls.getHTML(d.controls)});this._data[c]=a;return d=this._ed.apply_filters("component",d,a)},get:function(a){a=this._ed._elem.find('.mmtl-component[data-id="'+a+'"]');return 0==a.length?null:a},getData:function(a){return this._ed.option("components")[a]||null},getMetaHTML:function(a){html="";jQuery.each(a,function(a,c){c=jQuery.extend({title:"",type:"",text:""},c);html+=jQuery.trim(wp.template("mmtl-meta")(c))});return html},add:function(a,b,c,d){var e=this._ed._elem.find(".mmtl-content"),
f=this;b="undefined"!==typeof b&&b&&0!=jQuery(b).length?jQuery(b).hasClass("mmtl-component")?jQuery(b).find("> .mmtl-component-inner > .mmtl-component-content"):0<jQuery(b).closest(".mmtl-component-content").length?jQuery(b).closest(".mmtl-component-content"):e:e;if("undefined"===typeof c||!1===c)c=jQuery(b).children().length;0>=c?jQuery(b).prepend(a):c>=jQuery(b).children().length?jQuery(b).append(a):jQuery(a).insertBefore(jQuery(b).children().eq(c));jQuery(a).find(".mmtl-component").andSelf().each(function(){f._ed.trigger("component_added",
[this,d])})},remove:function(a){var b,c,d=this;jQuery(a).find(".mmtl-component").andSelf().each(function(){b=jQuery(this).closest(".mmtl-component");c=jQuery(this).index();d._ed.components.removeShortcode(this);jQuery(this).remove();d._ed.trigger("component_removed",[this,b,c])})},copy:function(a){a=this.toShortcode(a);return this._ed.do_shortcode(a)},toShortcode:function(a){var b=this;if("undefined"===typeof a){var c="";this._ed._elem.find(".mmtl-content > .mmtl-component").each(function(){c+=b._ed.components.toShortcode(this)});
return c}var d=this.getShortcode(a);a=jQuery(a).find("> .mmtl-component-inner > .mmtl-component-content");c="";c+="["+d.tag;jQuery.each(d.attrs.named,function(a,b){b=b.replace(/"/g,"'");c+=" "+a+'="'+b+'"'});if("single"===d.type)return c+"]";if("self-closing"===d.type)return c+" /]";c+="]";0<a.find("> .mmtl-component").length?(jQuery.each(a.find("> .mmtl-component"),function(){c+=b._ed.components.toShortcode(this)}),d.content=""):c+=d.content||"";return c+="[/"+d.tag+"]"},getShortcode:function(a){a=
jQuery(a).data("id");return this._data[a]},setShortcode:function(a,b){var c=jQuery(a).data("id"),d=this._data[c];this._data[c]=b;this._ed.trigger("shortcode_update",[b,d,a])},removeShortcode:function(a){var b=jQuery(a).data("id");jQuery(a).attr("data-id","");delete this._data[b]}};p.prototype={constructor:p,_ed:null,_controls:{},add:function(a,b){var c=jQuery.extend({id:a,text:"",title:"",icon:"",click:function(){}},b);this._controls[c.id]=c},get:function(a){var b=this;if("undefined"===typeof a)return this._controls;
if("object"===typeof a){var c=[],d;jQuery.each(a,function(a,f){d=b.get(f);if(!d)return!0;c.push(d)});return c}return this._controls.hasOwnProperty(a)?this._controls[a]:null},getHTML:function(a){"undefined"!==typeof a&&"object"!==typeof a&&(a=[a]);a=this.get(a);var b="";jQuery.each(a,function(a,d){b+=wp.template("mmtl-control")(d)});return b}};q.prototype={constructor:q,_ed:null,sendRequest:function(a,b,c){var d=this._ed._elem.find(".mmtl-loader").show();if(a){0!==a.indexOf("mmtl_")&&(a="mmtl_"+a);
var e={};b=jQuery.extend(b,(e.action=a,e[this._ed.option("noncename")]=this._ed.option("nonce"),e))}return jQuery.post(this._ed.option("ajaxurl"),b,c).always(function(a,b,c){d.hide()})}};jQuery.fn.mmtl_prepare_tabs=function(a){a=jQuery.extend({separator:"h3",heading:null,not:""},a);return this.each(function(b){var c=jQuery("<ul></ul>");jQuery(this).find(a.separator).each(function(){var b;b=a.heading?jQuery(this).find(a.heading):jQuery(this);var e="tab-"+b.text().replace(/\s+/g,"-").toLowerCase(),
f=jQuery("<div></div>");f.attr("id",e);b.nextUntil(a.separator).andSelf().wrapAll(f);f=jQuery("<li><a></a></li>");f.find("a").attr("href","#"+e).text(b.text());c.append(f)});0<c.find("> li").length&&jQuery(this).prepend(c)})};window.MMTL_Editor=g})();